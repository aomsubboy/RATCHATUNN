<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (‡∏£‡∏≤‡∏ä‡∏ó‡∏±‡∏ì‡∏ë‡πå)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand-from:#0ea5e9; --brand-to:#2563eb; }
    *{font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    .glass{backdrop-filter: blur(10px); background:rgba(255,255,255,.7)}
    .brand-grad{background-image:linear-gradient(135deg,var(--brand-from),var(--brand-to));}
    .sparkle{position:relative}
    .sparkle:after{content:"";position:absolute;inset:-2px;pointer-events:none;background:radial-gradient(closest-side,rgba(255,255,255,.7),transparent 70%);opacity:.3;filter:blur(6px)}
    .btn{transition:.2s ease;}
    .btn:hover{transform:translateY(-1px);}
    .shadow-soft{box-shadow:0 10px 25px rgba(2,6,23,.08)}
    .card{border-radius:1rem; box-shadow:0 10px 30px rgba(2,6,23,.08)}
    .pill{border-radius:9999px}
    .hidden-el{display:none}
    .mood-btn[aria-pressed="true"]{outline:2px solid rgba(59,130,246,.5); box-shadow:0 0 0 3px rgba(59,130,246,.15) inset}
    .option-chip{border:1px solid rgba(2,6,23,.06)}
    .modal-backdrop{background:rgba(2,6,23,.55)}
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- TOP BAR -->
  <header class="brand-grad text-white">
    <div class="max-w-6xl mx-auto px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-white/20 grid place-items-center shadow-soft">
          <svg viewBox="0 0 24 24" class="w-6 h-6"><path fill="currentColor" d="M12 2a9 9 0 0 0-9 9c0 5.25 4.5 9 9 11c4.5-2 9-5.75 9-11a9 9 0 0 0-9-9m0 4a3 3 0 0 1 3 3c0 1.66-1.34 3-3 3s-3-1.34-3-3a3 3 0 0 1 3-3Z"/></svg>
        </div>
        <h1 class="text-xl sm:text-2xl font-semibold">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (‡∏£‡∏≤‡∏ä‡∏ó‡∏±‡∏ì‡∏ë‡πå)</h1>
      </div>
      <div id="userBadge" class="text-white/90 text-sm"></div>
    </div>
  </header>

  <!-- APP WRAPPER -->
  <main class="max-w-6xl mx-auto p-6 -mt-8">
    <!-- LOGIN CARD -->
    <section id="loginCard" class="card glass p-6 sm:p-8 bg-white">
      <div class="flex items-start justify-between">
        <div>
          <h2 class="text-2xl font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h2>
          <p class="text-slate-600 mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        </div>
        <div class="text-sm text-slate-500">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô: SPA / Local only</div>
      </div>
      <div class="grid sm:grid-cols-2 gap-4 mt-6">
        <div>
          <label class="block text-sm mb-2">Username</label>
          <input id="username" class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Username" />
        </div>
        <div>
          <label class="block text-sm mb-2">Password</label>
          <input id="password" type="password" class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Password" />
        </div>
      </div>
      <div class="mt-6 flex items-center gap-3">
        <button id="btnLogin" class="btn pill px-5 py-3 bg-blue-600 text-white hover:bg-blue-700 shadow-soft">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <span class="text-slate-500 text-sm">* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πÇ‡∏°‡πà (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</span>
      </div>
    </section>

    <!-- APP BODY -->
    <section id="appBody" class="hidden-el">
      <!-- NAV TABS -->
      <nav class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button data-tab="mood" class="tab btn card p-4 text-left bg-white hover:bg-slate-50">
          <div class="flex items-center gap-3">
            <span class="pill px-3 py-1 bg-blue-50 text-blue-700 text-xs">‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 1</span>
            <h3 class="font-semibold">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h3>
          </div>
          <p class="text-slate-600 mt-1 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå 6 ‡πÅ‡∏ö‡∏ö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ç‡∏≤‡∏ï‡∏¥ / ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</p>
        </button>
        <button data-tab="pmhq" class="tab btn card p-4 text-left bg-white hover:bg-slate-50">
          <div class="flex items-center gap-3">
            <span class="pill px-3 py-1 bg-violet-50 text-violet-700 text-xs">‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 2</span>
            <h3 class="font-semibold">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (PMHQ)</h3>
          </div>
          <p class="text-slate-600 mt-1 text-sm">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 24 ‡∏Ç‡πâ‡∏≠ ‡∏≠‡∏≠‡∏Å‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        </button>
        <button data-tab="reports" class="tab btn card p-4 text-left bg-white hover:bg-slate-50">
          <div class="flex items-center gap-3">
            <span class="pill px-3 py-1 bg-emerald-50 text-emerald-700 text-xs">‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 3</span>
            <h3 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• & Dashboard</h3>
          </div>
          <p class="text-slate-600 mt-1 text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 2 ‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏≤‡∏ü</p>
        </button>
      </nav>

      <!-- TAB: MOOD -->
      <section id="tab-mood" class="card bg-white p-6 sm:p-8 mt-6">
        <h3 class="text-xl font-semibold">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h3>
        <p class="text-slate-600 mt-1">‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</p>

        <div class="grid sm:grid-cols-3 gap-4 mt-6">
          <div class="sm:col-span-1">
            <label class="block text-sm mb-2">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á</label>
            <input id="moodPid" class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:ring-2 focus:ring-blue-400" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6810100001"/>
          </div>
          <div class="sm:col-span-2">
            <label class="block text-sm mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á</label>
            <input id="moodName" disabled class="w-full rounded-xl bg-slate-50 border border-slate-200 px-4 py-3" placeholder="‚Äî"/>
          </div>
        </div>

        <div class="mt-4">
          <span class="block text-sm mb-2">‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
          <div class="flex flex-wrap gap-2">
            <button class="option-chip pill px-3 py-2 bg-white hover:bg-slate-50" data-mctx="‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ç‡∏≤‡∏ï‡∏¥">‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ç‡∏≤‡∏ï‡∏¥</button>
            <button class="option-chip pill px-3 py-2 bg-white hover:bg-slate-50" data-mctx="‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button>
          </div>
        </div>

        <div class="mt-6">
          <span class="block text-sm mb-3">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</span>
          <div id="moodButtons" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
            <!-- buttons injected by JS -->
          </div>
        </div>

        <div class="mt-6 flex items-center gap-3">
          <button id="saveMood" class="btn pill px-5 py-3 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-40">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</button>
          <span class="text-slate-500 text-sm">‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (Local)</span>
        </div>
      </section>

      <!-- TAB: PMHQ -->
      <section id="tab-pmhq" class="card bg-white p-6 sm:p-8 mt-6">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-xl font-semibold">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (PMHQ ‚Äì Thai)</h3>
            <p class="text-slate-600 mt-1">24 ‡∏Ç‡πâ‡∏≠: 0=‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏¢, 1=‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á, 2=‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡πà‡∏≠‡∏¢, 3=‡∏ö‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å</p>
          </div>
          <div id="pmhqScoreBadge" class="pill px-3 py-2 text-sm bg-slate-100 text-slate-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: 0</div>
        </div>

        <div class="grid sm:grid-cols-3 gap-4 mt-6">
          <div class="sm:col-span-1">
            <label class="block text-sm mb-2">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á</label>
            <input id="pmhqPid" class="w-full rounded-xl border border-slate-200 px-4 py-3 focus:ring-2 focus:ring-violet-400" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6810100001"/>
          </div>
          <div class="sm:col-span-2">
            <label class="block text-sm mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á</label>
            <input id="pmhqName" disabled class="w-full rounded-xl bg-slate-50 border border-slate-200 px-4 py-3" placeholder="‚Äî"/>
          </div>
        </div>

        <form id="pmhqForm" class="mt-6 grid gap-4">
          <!-- Questions injected by JS -->
        </form>

        <div class="mt-6 flex items-center gap-3">
          <button id="submitPMHQ" class="btn pill px-5 py-3 bg-violet-600 text-white hover:bg-violet-700 disabled:opacity-40">‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</button>
          <span class="text-slate-500 text-sm">‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
        </div>
      </section>

      <!-- TAB: REPORTS -->
      <section id="tab-reports" class="card bg-white p-6 sm:p-8 mt-6">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-semibold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• & Dashboard</h3>
          <div class="flex items-center gap-2 text-sm">
            <button id="clearAll" class="pill px-3 py-2 bg-rose-50 text-rose-700 hover:bg-rose-100">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-4 mt-6">
          <div class="p-4 rounded-2xl bg-slate-50">
            <div class="text-xs text-slate-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</div>
            <div id="statMoodCount" class="text-2xl font-semibold">0</div>
          </div>
          <div class="p-4 rounded-2xl bg-slate-50">
            <div class="text-xs text-slate-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô PMHQ</div>
            <div id="statPMHQCount" class="text-2xl font-semibold">0</div>
          </div>
          <div class="p-4 rounded-2xl bg-slate-50">
            <div class="text-xs text-slate-500">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô PMHQ ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
            <div id="statPMHQRate" class="text-2xl font-semibold">0%</div>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6 mt-6">
          <div class="p-4 rounded-2xl bg-slate-50">
            <h4 class="font-semibold mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h4>
            <div id="recentMood" class="space-y-2 text-sm"></div>
          </div>
          <div class="p-4 rounded-2xl bg-slate-50">
            <h4 class="font-semibold mb-2">‡∏™‡∏£‡∏∏‡∏õ PMHQ ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h4>
            <div id="recentPMHQ" class="space-y-2 text-sm"></div>
          </div>
        </div>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <div class="p-4 rounded-2xl bg-white border border-slate-200">
            <h4 class="font-semibold mb-2">‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h4>
            <div id="chartMood" class="h-56 grid content-end gap-2" aria-label="Bar chart mood"></div>
          </div>
          <div class="p-4 rounded-2xl bg-white border border-slate-200">
            <h4 class="font-semibold mb-2">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô PMHQ</h4>
            <div id="chartPMHQ" class="h-56 grid content-end gap-2" aria-label="Bar chart pmhq"></div>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- MODAL -->
  <div id="modal" class="fixed inset-0 hidden-el items-center justify-center z-50">
    <div class="absolute inset-0 modal-backdrop"></div>
    <div class="relative w-[92%] max-w-md card bg-white p-6">
      <div class="flex items-start justify-between">
        <h4 id="modalTitle" class="text-lg font-semibold">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h4>
        <button id="closeModal" class="pill px-3 py-1 bg-slate-100 hover:bg-slate-200">‡∏õ‡∏¥‡∏î</button>
      </div>
      <p id="modalMsg" class="mt-3 text-slate-700"></p>
    </div>
  </div>

  <script>
    // ------- Static datasets -------
    const USERS = { username: 'StaffPrisoners', password: '112233' };
    const INMATES = {
      '6810100001': '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏ß‡∏±‡∏á‡∏î‡∏µ',
      '6810100002': '‡∏ô‡∏≤‡∏¢‡∏™‡∏µ‡∏™‡∏≤ ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥',
      '6810100003': '‡∏ô‡∏≤‡∏¢‡∏û‡∏´‡∏ß‡∏±‡∏á‡∏ä‡∏≤ ‡πÇ‡∏™‡∏†‡∏ì',
      '6810100004': '‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏ô‡∏¢‡πå ‡∏°‡∏á‡∏Ñ‡∏•',
      '6810100005': '‡∏ô‡∏≤‡∏¢‡∏ó‡∏£‡∏≤‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏®‡∏£‡∏µ‡∏û‡∏±‡∏ô‡∏ò‡πå',
    };
    const MOODS = [
      { key:'‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô', emoji:'ü§©' },
      { key:'‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç', emoji:'üòä' },
      { key:'‡πÄ‡∏â‡∏¢‡πÜ', emoji:'üòê' },
      { key:'‡πÄ‡∏®‡∏£‡πâ‡∏≤', emoji:'üò¢' },
      { key:'‡∏Å‡∏•‡∏±‡∏ß', emoji:'üò®' },
      { key:'‡πÇ‡∏Å‡∏£‡∏ò', emoji:'üò†' },
    ];
    const PMHQ_QUESTIONS = [
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡πÇ‡∏Å‡∏ô‡∏î‡∏±‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∂‡∏î‡∏≠‡∏±‡∏î‡∏Ñ‡∏±‡∏ö‡πÅ‡∏Ñ‡πâ‡∏ô‡πÉ‡∏à',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏®‡∏£‡πâ‡∏≤ ‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à ‡∏à‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏à‡∏≥',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏à ‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à ‡πÉ‡∏ô‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏à‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡πâ‡∏≠‡πÅ‡∏ó‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï',
      '‡∏£‡∏∞‡∏¢‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡∏´‡∏ß‡∏≤‡∏î‡∏£‡∏∞‡πÅ‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏à‡∏≥‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏ß‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡∏™‡πà‡∏≤‡∏¢',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏õ‡∏ß‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏Ñ‡∏≠ ‡∏´‡∏•‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏´‡∏•‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πá‡∏ö‡∏õ‡πà‡∏ß‡∏¢',
      '‡∏£‡∏∞‡∏¢‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏á‡∏∏‡∏î‡∏´‡∏á‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÇ‡∏°‡πÇ‡∏´‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß ‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß',
      '‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡πà‡∏¢‡∏ß‡πÅ‡∏£‡∏á (‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡πá‡∏ô)',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏∏‡∏á‡∏™‡∏¥‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡∏´‡∏•‡∏±‡∏ö‡∏¢‡∏≤‡∏Å ‡∏´‡∏•‡∏±‡∏ö‡πÜ ‡∏ï‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏£‡πá‡∏ß/‡πÄ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏∑‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°‡∏≠‡∏¥‡πà‡∏°',
      '‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏û‡∏•‡∏µ‡∏¢‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ô‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß',
      '‡∏£‡∏∞‡∏¢‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏î ‡πÅ‡∏ô‡πà‡∏ô‡∏ó‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡πâ‡∏≠‡∏á‡∏≠‡∏∑‡∏î‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏ü‡πâ‡∏≠',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏Ñ‡∏¥‡∏î‡∏ß‡∏Å‡πÑ‡∏õ‡∏ß‡∏ô‡∏°‡∏≤‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î‡πÑ‡∏î‡πâ',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏á‡∏•‡∏∑‡∏°‡∏á‡πà‡∏≤‡∏¢ ‡∏à‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏°‡∏µ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏î‡∏µ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏à‡∏≥‡∏à‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≠‡πÑ‡∏õ',
      '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ú‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏õ‡∏≤‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥',
      '‡∏û‡∏±‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏Å‡∏Å‡∏≥‡πÅ‡∏û‡∏á ‡∏Å‡∏£‡∏µ‡∏î‡πÅ‡∏Ç‡∏ô ‡πÇ‡∏Ç‡∏Å‡∏®‡∏µ‡∏£‡∏©‡∏∞',
    ];

    // ------- Helpers -------
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>Array.from(document.querySelectorAll(q));

    const storage = {
      get moods(){ return JSON.parse(localStorage.getItem('moods')||'[]') },
      set moods(v){ localStorage.setItem('moods', JSON.stringify(v)) },
      get pmhq(){ return JSON.parse(localStorage.getItem('pmhq')||'[]') },
      set pmhq(v){ localStorage.setItem('pmhq', JSON.stringify(v)) },
      clear(){ localStorage.removeItem('moods'); localStorage.removeItem('pmhq'); }
    }

    function showModal(title,msg){
      $('#modalTitle').textContent=title; $('#modalMsg').textContent=msg;
      $('#modal').classList.remove('hidden-el');
      $('#modal').classList.add('flex');
    }
    function hideModal(){ $('#modal').classList.add('hidden-el'); $('#modal').classList.remove('flex'); }

    function findInmate(pid){ return INMATES[pid?.trim()] || null }

    function fmtDate(ts){
      const d = new Date(ts);
      return d.toLocaleString('th-TH',{ dateStyle:'medium', timeStyle:'short' });
    }

    function classifyPMHQ(score){ return score >= 29 ? {label:'‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï', color:'bg-rose-100 text-rose-700'} : {label:'‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏õ‡∏Å‡∏ï‡∏¥', color:'bg-emerald-100 text-emerald-700'} }

    function selfCareTips(){
      return [
        '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏∂‡∏Å ‡πÜ ‡∏ä‡πâ‡∏≤ ‡πÜ 3‚Äì5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•',
        '‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏•‡∏î‡∏Ñ‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô',
        '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡∏¥‡∏ô/‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î 10‚Äì15 ‡∏ô‡∏≤‡∏ó‡∏µ',
        '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì',
        '‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà/‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß',
      ]
    }

    // ------- Auth -------
    $('#btnLogin').addEventListener('click', ()=>{
      const u = $('#username').value.trim();
      const p = $('#password').value.trim();
      if(u===USERS.username && p===USERS.password){
        $('#loginCard').classList.add('hidden-el');
        $('#appBody').classList.remove('hidden-el');
        $('#userBadge').textContent = `‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ${u}`;
      }else{
        showModal('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
      }
    });

    $('#closeModal').addEventListener('click', hideModal);

    // ------- Tabs -------
    $$('.tab').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const t = btn.getAttribute('data-tab');
        ['mood','pmhq','reports'].forEach(k=>$('#tab-'+k).classList.add('hidden-el'));
        $('#tab-'+t).classList.remove('hidden-el');
        $$('.tab').forEach(b=>b.classList.remove('ring-2','ring-blue-400'));
        btn.classList.add('ring-2','ring-blue-400');
        if(t==='reports') renderReports();
      })
    })

    // ------- Mood UI -------
    const moodButtons = $('#moodButtons');
    let selectedMood = null; let moodContext = null; let moodPid=''; let moodName='';

    MOODS.forEach(({key,emoji})=>{
      const b = document.createElement('button');
      b.className = 'mood-btn btn p-4 rounded-xl border border-slate-200 hover:bg-slate-50 flex items-center gap-3';
      b.innerHTML = `<span class="text-2xl">${emoji}</span><span class="font-medium">${key}</span>`;
      b.setAttribute('data-mood', key);
      b.setAttribute('aria-pressed','false');
      b.addEventListener('click',()=>{
        selectedMood = key;
        $$('.mood-btn').forEach(x=>{x.setAttribute('aria-pressed','false'); x.classList.remove('bg-blue-50','border-blue-300')});
        b.setAttribute('aria-pressed','true'); b.classList.add('bg-blue-50','border-blue-300');
        checkMoodReady();
      })
      moodButtons.appendChild(b);
    })

    $$('#tab-mood .option-chip').forEach(ch=>{
      ch.addEventListener('click',()=>{
        $$('#tab-mood .option-chip').forEach(x=>x.classList.remove('bg-blue-50','text-blue-700','border-blue-200'))
        ch.classList.add('bg-blue-50','text-blue-700','border-blue-200');
        moodContext = ch.getAttribute('data-mctx');
        checkMoodReady();
      })
    })

    $('#moodPid').addEventListener('change',()=>{
      moodPid = $('#moodPid').value.trim();
      const name = findInmate(moodPid);
      if(name){ moodName = name; $('#moodName').value=name; }
      else { moodName=''; $('#moodName').value='‚Äî'; showModal('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á'); }
      checkMoodReady();
    })

    function checkMoodReady(){
      $('#saveMood').disabled = !(moodPid && moodName && selectedMood && moodContext);
    }

    $('#saveMood').addEventListener('click',()=>{
      const rec = { type:'mood', ts:Date.now(), pid:moodPid, name:moodName, mood:selectedMood, context:moodContext };
      const all = storage.moods; all.push(rec); storage.moods = all;
      showModal('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå: ${selectedMood} (${moodContext}) ‡∏Ç‡∏≠‡∏á ${moodName}`);
      // reset selections (keep pid)
      selectedMood = null; $$('.mood-btn').forEach(x=>{x.setAttribute('aria-pressed','false'); x.classList.remove('bg-blue-50','border-blue-300')});
      moodContext = null; $$('#tab-mood .option-chip').forEach(x=>x.classList.remove('bg-blue-50','text-blue-700','border-blue-200'))
      renderReports();
    })

    // ------- PMHQ UI -------
    let pmhqPid = ''; let pmhqName='';

    $('#pmhqPid').addEventListener('change',()=>{
      pmhqPid = $('#pmhqPid').value.trim();
      const name = findInmate(pmhqPid);
      if(name){ pmhqName = name; $('#pmhqName').value=name; }
      else { pmhqName=''; $('#pmhqName').value='‚Äî'; showModal('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏±‡∏á'); }
      updatePMHQScore();
    })

    // render questions
    const form = $('#pmhqForm');
    PMHQ_QUESTIONS.forEach((q,idx)=>{
      const row = document.createElement('div');
      row.className='p-4 rounded-xl border border-slate-200';
      row.innerHTML = `
        <div class="font-medium">${idx+1}. ${q}</div>
        <div class="mt-3 flex flex-wrap gap-2 text-sm">
          ${[0,1,2,3].map(v=>`<label class="pill px-3 py-2 bg-white hover:bg-slate-50 border cursor-pointer">
            <input type="radio" name="q${idx}" value="${v}" class="mr-2">${['‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏¢','‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á','‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡πà‡∏≠‡∏¢','‡∏ö‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å'][v]}
          </label>`).join('')}
        </div>`;
      form.appendChild(row);
    })

    function getPMHQScore(){
      let score = 0; let answered=0; const answers=[];
      PMHQ_QUESTIONS.forEach((_,idx)=>{
        const v = form.querySelector(`input[name=q${idx}]:checked`);
        const val = v?Number(v.value):null; answers.push(val);
        if(val!==null){ score+=val; answered++; }
      });
      return {score, answered, answers};
    }

    function updatePMHQScore(){
      const {score, answered} = getPMHQScore();
      const badge = $('#pmhqScoreBadge');
      badge.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${score} (‡∏ï‡∏≠‡∏ö ${answered}/24)`;
    }

    form.addEventListener('change', updatePMHQScore);

    $('#submitPMHQ').addEventListener('click',()=>{
      const {score, answered, answers} = getPMHQScore();
      if(!(pmhqPid && pmhqName)) return showModal('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
      if(answered < PMHQ_QUESTIONS.length) return showModal('‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 24 ‡∏Ç‡πâ‡∏≠');
      const cls = classifyPMHQ(score);
      const rec = { type:'pmhq', ts:Date.now(), pid:pmhqPid, name:pmhqName, score, answers, result:cls.label };
      const all = storage.pmhq; all.push(rec); storage.pmhq = all;

      const tips = selfCareTips().map(t=>`‚Ä¢ ${t}`).join('\n');
      showModal('‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', `‡∏ä‡∏∑‡πà‡∏≠: ${pmhqName}\n‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${score}\n‡∏ú‡∏•: ${cls.label}\n\n‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï:\n${tips}`);
      renderReports();
      // optional scroll to reports
    })

    // ------- Reports & mini-charts (CSS bars) -------
    function renderReports(){
      // stats
      const moods = storage.moods.sort((a,b)=>b.ts-a.ts);
      const pmhq = storage.pmhq.sort((a,b)=>b.ts-a.ts);
      $('#statMoodCount').textContent = moods.length;
      $('#statPMHQCount').textContent = pmhq.length;
      const pos = pmhq.filter(x=>x.score>=29).length;
      $('#statPMHQRate').textContent = pmhq.length? Math.round((pos*100)/pmhq.length)+"%":'0%';

      // lists
      const rm = $('#recentMood'); rm.innerHTML = '';
      moods.slice(0,10).forEach(rec=>{
        const el = document.createElement('div');
        el.className='p-3 bg-white rounded-xl border text-slate-700 flex items-center justify-between';
        el.innerHTML = `<div><div class="font-medium">${rec.name} <span class="text-slate-400">(${rec.pid})</span></div>
                        <div class="text-xs text-slate-500">${rec.context} ‚Ä¢ ${fmtDate(rec.ts)}</div></div>
                        <div class="text-base">${rec.mood}</div>`;
        rm.appendChild(el);
      })

      const rp = $('#recentPMHQ'); rp.innerHTML='';
      pmhq.slice(0,10).forEach(rec=>{
        const el = document.createElement('div');
        const cls = rec.score>=29? 'text-rose-700 bg-rose-50':'text-emerald-700 bg-emerald-50';
        el.className='p-3 bg-white rounded-xl border text-slate-700 flex items-center justify-between';
        el.innerHTML = `<div><div class="font-medium">${rec.name} <span class="text-slate-400">(${rec.pid})</span></div>
                        <div class="text-xs text-slate-500">${fmtDate(rec.ts)}</div></div>
                        <div class="pill px-3 py-1 ${cls}">${rec.score} ‚Ä¢ ${rec.result}</div>`;
        rp.appendChild(el);
      })

      // charts
      renderBar('#chartMood', countByMood(moods), '‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      renderBar('#chartPMHQ', bucketPMHQ(pmhq), '‡∏Ñ‡∏ô');
    }

    function countByMood(moods){
      const map = {}; MOODS.forEach(m=>map[m.key]=0);
      moods.forEach(m=>{ map[m.mood] = (map[m.mood]||0)+1 });
      return Object.entries(map).map(([label,value])=>({label,value}));
    }

    function bucketPMHQ(pmhq){
      const buckets = [
        {label:'0‚Äì10',min:0,max:10,count:0},
        {label:'11‚Äì20',min:11,max:20,count:0},
        {label:'21‚Äì28',min:21,max:28,count:0},
        {label:'29‚Äì36',min:29,max:36,count:0},
        {label:'37‚Äì48',min:37,max:48,count:0},
        {label:'49‚Äì72',min:49,max:72,count:0},
      ];
      pmhq.forEach(r=>{
        const b = buckets.find(b=>r.score>=b.min && r.score<=b.max); if(b) b.count++;
      })
      return buckets.map(b=>({label:b.label, value:b.count}))
    }

    function renderBar(selector, rows, unit){
      const host = document.querySelector(selector);
      host.innerHTML = '';
      const max = Math.max(1, ...rows.map(r=>r.value));
      rows.forEach(r=>{
        const wrap = document.createElement('div'); wrap.className='grid grid-cols-5 gap-2 items-end';
        const barBox = document.createElement('div'); barBox.className='col-span-5 h-40 flex items-end gap-2';
        // bar
        const bar = document.createElement('div');
        const h = Math.round((r.value/max)*100);
        bar.style.height = Math.max(4, h)+'%';
        bar.className='flex-1 bg-gradient-to-t from-blue-200 to-blue-500 rounded-t-xl shadow-soft relative';
        const tag = document.createElement('div'); tag.className='absolute -top-6 left-1/2 -translate-x-1/2 text-xs text-slate-700'; tag.textContent = r.value;
        bar.appendChild(tag); barBox.appendChild(bar);
        // label
        const label = document.createElement('div'); label.className='text-xs text-center mt-2 text-slate-600'; label.textContent = r.label;
        const item = document.createElement('div'); item.appendChild(barBox); item.appendChild(label);
        host.appendChild(item);
      })
    }

    // Clear data
    $('#clearAll').addEventListener('click',()=>{
      storage.clear(); renderReports(); showModal('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß','‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ');
    })

    // Default: show Mood tab on login
  </script>
</body>
</html>
